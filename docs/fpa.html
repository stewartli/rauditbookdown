<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 FP&amp;A | Data Analytics in R</title>
  <meta name="description" content="A complete use case for accounting professionals who want to leverage computer programming languages in their work." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 FP&amp;A | Data Analytics in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/stewartli/rauditbookdown" />
  
  <meta property="og:description" content="A complete use case for accounting professionals who want to leverage computer programming languages in their work." />
  <meta name="github-repo" content="https://github.com/stewartli/rauditbookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 FP&amp;A | Data Analytics in R" />
  
  <meta name="twitter:description" content="A complete use case for accounting professionals who want to leverage computer programming languages in their work." />
  

<meta name="author" content="Stewart Li" />


<meta name="date" content="2021-12-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="import.html"/>
<link rel="next" href="external-auditors.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="libs/d3-4.10.2/d3.min.js"></script>
<link href="libs/collapsibleTree-0.1.6/collapsibleTree.css" rel="stylesheet" />
<script src="libs/collapsibleTree-binding-0.1.7/collapsibleTree.js"></script>
<link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="libs/wordcloud2-0.0.1/hover.js"></script>
<script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Analytics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="intror.html"><a href="intror.html"><i class="fa fa-check"></i><b>2</b> R basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intror.html"><a href="intror.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="intror.html"><a href="intror.html#help"><i class="fa fa-check"></i><b>2.2</b> Help</a></li>
<li class="chapter" data-level="2.3" data-path="intror.html"><a href="intror.html#variable"><i class="fa fa-check"></i><b>2.3</b> Variable</a></li>
<li class="chapter" data-level="2.4" data-path="intror.html"><a href="intror.html#data-structure"><i class="fa fa-check"></i><b>2.4</b> Data structure</a></li>
<li class="chapter" data-level="2.5" data-path="intror.html"><a href="intror.html#control-flow"><i class="fa fa-check"></i><b>2.5</b> Control flow</a></li>
<li class="chapter" data-level="2.6" data-path="intror.html"><a href="intror.html#function"><i class="fa fa-check"></i><b>2.6</b> Function</a></li>
<li class="chapter" data-level="2.7" data-path="intror.html"><a href="intror.html#oop"><i class="fa fa-check"></i><b>2.7</b> OOP</a></li>
<li class="chapter" data-level="2.8" data-path="intror.html"><a href="intror.html#io"><i class="fa fa-check"></i><b>2.8</b> IO</a></li>
<li class="chapter" data-level="2.9" data-path="intror.html"><a href="intror.html#system"><i class="fa fa-check"></i><b>2.9</b> System</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>3</b> Import</a>
<ul>
<li class="chapter" data-level="3.1" data-path="import.html"><a href="import.html#dataset"><i class="fa fa-check"></i><b>3.1</b> Dataset</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="import.html"><a href="import.html#data-to-database"><i class="fa fa-check"></i><b>3.1.1</b> Data to database</a></li>
<li class="chapter" data-level="3.1.2" data-path="import.html"><a href="import.html#data-model"><i class="fa fa-check"></i><b>3.1.2</b> Data model</a></li>
<li class="chapter" data-level="3.1.3" data-path="import.html"><a href="import.html#join-tables"><i class="fa fa-check"></i><b>3.1.3</b> Join tables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="import.html"><a href="import.html#sqlite"><i class="fa fa-check"></i><b>3.2</b> SQLite</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="import.html"><a href="import.html#connection"><i class="fa fa-check"></i><b>3.2.1</b> Connection</a></li>
<li class="chapter" data-level="3.2.2" data-path="import.html"><a href="import.html#r-code-chunk"><i class="fa fa-check"></i><b>3.2.2</b> R code chunk</a></li>
<li class="chapter" data-level="3.2.3" data-path="import.html"><a href="import.html#sql-code-chunk"><i class="fa fa-check"></i><b>3.2.3</b> SQL code chunk</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fpa.html"><a href="fpa.html"><i class="fa fa-check"></i><b>4</b> FP&amp;A</a>
<ul>
<li class="chapter" data-level="4.1" data-path="fpa.html"><a href="fpa.html#validation"><i class="fa fa-check"></i><b>4.1</b> Validation</a></li>
<li class="chapter" data-level="4.2" data-path="fpa.html"><a href="fpa.html#eda"><i class="fa fa-check"></i><b>4.2</b> EDA</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="fpa.html"><a href="fpa.html#categorical"><i class="fa fa-check"></i><b>4.2.1</b> Categorical</a></li>
<li class="chapter" data-level="4.2.2" data-path="fpa.html"><a href="fpa.html#numeric"><i class="fa fa-check"></i><b>4.2.2</b> Numeric</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="fpa.html"><a href="fpa.html#business-ananlysis"><i class="fa fa-check"></i><b>4.3</b> Business ananlysis</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="fpa.html"><a href="fpa.html#product-profit-margin"><i class="fa fa-check"></i><b>4.3.1</b> Product profit margin</a></li>
<li class="chapter" data-level="4.3.2" data-path="fpa.html"><a href="fpa.html#product-category"><i class="fa fa-check"></i><b>4.3.2</b> Product category</a></li>
<li class="chapter" data-level="4.3.3" data-path="fpa.html"><a href="fpa.html#manufactuer"><i class="fa fa-check"></i><b>4.3.3</b> Manufactuer</a></li>
<li class="chapter" data-level="4.3.4" data-path="fpa.html"><a href="fpa.html#store"><i class="fa fa-check"></i><b>4.3.4</b> Store</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="fpa.html"><a href="fpa.html#info-graphic"><i class="fa fa-check"></i><b>4.4</b> Info graphic</a></li>
<li class="chapter" data-level="4.5" data-path="fpa.html"><a href="fpa.html#report"><i class="fa fa-check"></i><b>4.5</b> Report</a></li>
<li class="chapter" data-level="4.6" data-path="fpa.html"><a href="fpa.html#dashboard"><i class="fa fa-check"></i><b>4.6</b> Dashboard</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="external-auditors.html"><a href="external-auditors.html"><i class="fa fa-check"></i><b>5</b> External Auditors</a>
<ul>
<li class="chapter" data-level="5.1" data-path="external-auditors.html"><a href="external-auditors.html#cleaning"><i class="fa fa-check"></i><b>5.1</b> Cleaning</a></li>
<li class="chapter" data-level="5.2" data-path="external-auditors.html"><a href="external-auditors.html#validation-1"><i class="fa fa-check"></i><b>5.2</b> Validation</a></li>
<li class="chapter" data-level="5.3" data-path="external-auditors.html"><a href="external-auditors.html#eda-1"><i class="fa fa-check"></i><b>5.3</b> EDA</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="external-auditors.html"><a href="external-auditors.html#missing-value"><i class="fa fa-check"></i><b>5.3.1</b> Missing value</a></li>
<li class="chapter" data-level="5.3.2" data-path="external-auditors.html"><a href="external-auditors.html#categorical-1"><i class="fa fa-check"></i><b>5.3.2</b> Categorical</a></li>
<li class="chapter" data-level="5.3.3" data-path="external-auditors.html"><a href="external-auditors.html#numberic"><i class="fa fa-check"></i><b>5.3.3</b> Numberic</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="external-auditors.html"><a href="external-auditors.html#audit-planning"><i class="fa fa-check"></i><b>5.4</b> Audit planning</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="external-auditors.html"><a href="external-auditors.html#test-of-controls"><i class="fa fa-check"></i><b>5.4.1</b> Test of controls</a></li>
<li class="chapter" data-level="5.4.2" data-path="external-auditors.html"><a href="external-auditors.html#digits-tests"><i class="fa fa-check"></i><b>5.4.2</b> Digits tests</a></li>
<li class="chapter" data-level="5.4.3" data-path="external-auditors.html"><a href="external-auditors.html#benfords-law"><i class="fa fa-check"></i><b>5.4.3</b> Benford’s law</a></li>
<li class="chapter" data-level="5.4.4" data-path="external-auditors.html"><a href="external-auditors.html#outlier"><i class="fa fa-check"></i><b>5.4.4</b> Outlier</a></li>
<li class="chapter" data-level="5.4.5" data-path="external-auditors.html"><a href="external-auditors.html#ratios"><i class="fa fa-check"></i><b>5.4.5</b> Ratios</a></li>
<li class="chapter" data-level="5.4.6" data-path="external-auditors.html"><a href="external-auditors.html#cutomers"><i class="fa fa-check"></i><b>5.4.6</b> Cutomers</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="external-auditors.html"><a href="external-auditors.html#substantive-test"><i class="fa fa-check"></i><b>5.5</b> Substantive test</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="external-auditors.html"><a href="external-auditors.html#reconcilation"><i class="fa fa-check"></i><b>5.5.1</b> Reconcilation</a></li>
<li class="chapter" data-level="5.5.2" data-path="external-auditors.html"><a href="external-auditors.html#aging-report"><i class="fa fa-check"></i><b>5.5.2</b> Aging report</a></li>
<li class="chapter" data-level="5.5.3" data-path="external-auditors.html"><a href="external-auditors.html#confirmation-letter"><i class="fa fa-check"></i><b>5.5.3</b> Confirmation letter</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="external-auditors.html"><a href="external-auditors.html#reporting"><i class="fa fa-check"></i><b>5.6</b> Reporting</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="utilities.html"><a href="utilities.html"><i class="fa fa-check"></i><b>6</b> Utilities</a>
<ul>
<li class="chapter" data-level="6.1" data-path="utilities.html"><a href="utilities.html#command-line-tool"><i class="fa fa-check"></i><b>6.1</b> Command line tool</a></li>
<li class="chapter" data-level="6.2" data-path="utilities.html"><a href="utilities.html#pdf-data"><i class="fa fa-check"></i><b>6.2</b> PDF data</a></li>
<li class="chapter" data-level="6.3" data-path="utilities.html"><a href="utilities.html#learnr"><i class="fa fa-check"></i><b>6.3</b> Learnr</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analytics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fpa" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> FP&amp;A</h1>
<p>In general, FP&amp;A produce a business insight report after analyzed varying source of data. Their workflow includes 1) data extraction out of a database; 2) data validation; 3) thoroughly analysis; 4) graphic presentation; 5) reports in various forms; 6) dashboard. Although this chapter is written from FP&amp;A point of view, techniques can be used by other accounting professionals.</p>
<div id="validation" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Validation</h2>
<p>Data is validated based on your expectation before detailed analysis. For instance, sales unit price is expected to be positive number. sales unit price multiply with sales quantity is expected to equal to sales amount.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="fpa.html#cb227-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&#39;data/sales_df.csv&#39;</span>), <span class="at">name_repair =</span> janitor<span class="sc">::</span>make_clean_names) </span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="fpa.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(validate)</span>
<span id="cb228-2"><a href="fpa.html#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="fpa.html#cb228-3" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb228-4"><a href="fpa.html#cb228-4" aria-hidden="true" tabindex="-1"></a>  validate<span class="sc">::</span><span class="fu">check_that</span>(</span>
<span id="cb228-5"><a href="fpa.html#cb228-5" aria-hidden="true" tabindex="-1"></a>    sales_unit_price <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb228-6"><a href="fpa.html#cb228-6" aria-hidden="true" tabindex="-1"></a>    sales_unit_cost <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb228-7"><a href="fpa.html#cb228-7" aria-hidden="true" tabindex="-1"></a>    sales_quantity <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb228-8"><a href="fpa.html#cb228-8" aria-hidden="true" tabindex="-1"></a>    return_quantity <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb228-9"><a href="fpa.html#cb228-9" aria-hidden="true" tabindex="-1"></a>    discount_quantity <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb228-10"><a href="fpa.html#cb228-10" aria-hidden="true" tabindex="-1"></a>    discount_percent <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb228-11"><a href="fpa.html#cb228-11" aria-hidden="true" tabindex="-1"></a>    sales_unit_price <span class="sc">&gt;=</span> sales_unit_cost, </span>
<span id="cb228-12"><a href="fpa.html#cb228-12" aria-hidden="true" tabindex="-1"></a>    sales_quantity <span class="sc">&gt;=</span> return_quantity,  </span>
<span id="cb228-13"><a href="fpa.html#cb228-13" aria-hidden="true" tabindex="-1"></a>    sales_quantity <span class="sc">&gt;=</span> discount_quantity, </span>
<span id="cb228-14"><a href="fpa.html#cb228-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span>((sales_unit_price <span class="sc">*</span> sales_quantity) <span class="sc">-</span> sales_amount) <span class="sc">&lt;</span> <span class="dv">10</span>, </span>
<span id="cb228-15"><a href="fpa.html#cb228-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span>((sales_unit_cost <span class="sc">*</span> sales_quantity) <span class="sc">-</span> total_cost) <span class="sc">&lt;</span> <span class="dv">10</span>, </span>
<span id="cb228-16"><a href="fpa.html#cb228-16" aria-hidden="true" tabindex="-1"></a>    sales_unit_price <span class="sc">*</span> return_quantity <span class="sc">-</span> return_amount <span class="sc">&lt;</span> <span class="dv">10</span>, </span>
<span id="cb228-17"><a href="fpa.html#cb228-17" aria-hidden="true" tabindex="-1"></a>    sales_unit_price <span class="sc">*</span> discount_percent <span class="sc">*</span> discount_quantity <span class="sc">-</span> discount_amount <span class="sc">&lt;</span> <span class="dv">10</span>, </span>
<span id="cb228-18"><a href="fpa.html#cb228-18" aria-hidden="true" tabindex="-1"></a>    sales_amount <span class="sc">&gt;=</span> total_cost, </span>
<span id="cb228-19"><a href="fpa.html#cb228-19" aria-hidden="true" tabindex="-1"></a>    sales_amount <span class="sc">&gt;=</span> return_amount, </span>
<span id="cb228-20"><a href="fpa.html#cb228-20" aria-hidden="true" tabindex="-1"></a>    sales_amount <span class="sc">&gt;=</span> discount_amount, </span>
<span id="cb228-21"><a href="fpa.html#cb228-21" aria-hidden="true" tabindex="-1"></a>    end_date <span class="sc">-</span> start_date <span class="sc">&lt;</span> <span class="dv">365</span>) </span>
<span id="cb228-22"><a href="fpa.html#cb228-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb228-23"><a href="fpa.html#cb228-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out)</span></code></pre></div>
<pre><code>&gt;    name  items passes fails nNA error warning
&gt; 1   V01 155732 155732     0   0 FALSE   FALSE
&gt; 2   V02 155732 155732     0   0 FALSE   FALSE
&gt; 3   V03 155732 155732     0   0 FALSE   FALSE
&gt; 4   V04 155732 155732     0   0 FALSE   FALSE
&gt; 5   V05 155732 155732     0   0 FALSE   FALSE
&gt; 6   V06 155732 155732     0   0 FALSE   FALSE
&gt; 7   V07 155732 155732     0   0 FALSE   FALSE
&gt; 8   V08 155732 155732     0   0 FALSE   FALSE
&gt; 9   V09 155732 155732     0   0 FALSE   FALSE
&gt; 10  V10 155732 107634 48098   0 FALSE   FALSE
&gt; 11  V11 155732 114188 41544   0 FALSE   FALSE
&gt; 12  V12 155732 155732     0   0 FALSE   FALSE
&gt; 13  V13 155732 155732     0   0 FALSE   FALSE
&gt; 14  V14 155732 155732     0   0 FALSE   FALSE
&gt; 15  V15 155732 155732     0   0 FALSE   FALSE
&gt; 16  V16 155732 155732     0   0 FALSE   FALSE
&gt; 17  V17 155732  89831 65901   0 FALSE   FALSE
&gt;                                                                        expression
&gt; 1                                                            sales_unit_price &gt; 0
&gt; 2                                                             sales_unit_cost &gt; 0
&gt; 3                                                              sales_quantity &gt; 0
&gt; 4                                                 (return_quantity - 0) &gt;= -1e-08
&gt; 5                                               (discount_quantity - 0) &gt;= -1e-08
&gt; 6                                                            discount_percent &lt; 1
&gt; 7                                  (sales_unit_price - sales_unit_cost) &gt;= -1e-08
&gt; 8                                    (sales_quantity - return_quantity) &gt;= -1e-08
&gt; 9                                  (sales_quantity - discount_quantity) &gt;= -1e-08
&gt; 10                   abs((sales_unit_price * sales_quantity) - sales_amount) &lt; 10
&gt; 11                      abs((sales_unit_cost * sales_quantity) - total_cost) &lt; 10
&gt; 12                        sales_unit_price * return_quantity - return_amount &lt; 10
&gt; 13 sales_unit_price * discount_percent * discount_quantity - discount_amount &lt; 10
&gt; 14                                          (sales_amount - total_cost) &gt;= -1e-08
&gt; 15                                       (sales_amount - return_amount) &gt;= -1e-08
&gt; 16                                     (sales_amount - discount_amount) &gt;= -1e-08
&gt; 17                                                    end_date - start_date &lt; 365</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="fpa.html#cb230-1" aria-hidden="true" tabindex="-1"></a>v_amt <span class="ot">&lt;-</span> validate<span class="sc">::</span><span class="fu">violating</span>(sales_df, out[<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>]) </span>
<span id="cb230-2"><a href="fpa.html#cb230-2" aria-hidden="true" tabindex="-1"></a>v_date <span class="ot">&lt;-</span> validate<span class="sc">::</span><span class="fu">violating</span>(sales_df, out[<span class="dv">17</span>]) </span></code></pre></div>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="fpa.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code></pre></div>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="fpa.html#cb232-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_validation_p1.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_validation_p1.png" width="960" /></p>
<p>Surprisingly, sales unit price multiply with sales quantity does not equal to sales amount. Those outlier are <code>filter</code> out to be examined in detail. If you were an external auditor and should pay a special attention to those as the sum of those immaterial misstatements becomes significantly material. Furthermore, it is unusual that promotion period (end date minus start date) is more than one year. It could be an error that stores whose status is off incur staff and rental cost. Since the illustration based on dummy data, those discreteness will be ignored subsequently.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="fpa.html#cb233-1" aria-hidden="true" tabindex="-1"></a>sales_df[<span class="fu">sample</span>(<span class="fu">nrow</span>(sales_df), <span class="dv">2000</span>), ] <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="fpa.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sales_amount, <span class="at">y =</span> sales_unit_price <span class="sc">*</span> sales_quantity)) <span class="sc">+</span></span>
<span id="cb233-3"><a href="fpa.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) </span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="fpa.html#cb234-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;img/fpa_validation_p2.png&#39;</span>)</span></code></pre></div>
<p><img src="img/fpa_validation_p2.png" width="960" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="fpa.html#cb235-1" aria-hidden="true" tabindex="-1"></a>d_amt <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb235-2"><a href="fpa.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">out_sales =</span> sales_unit_price <span class="sc">*</span> sales_quantity, </span>
<span id="cb235-3"><a href="fpa.html#cb235-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">res_sales =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(out_sales <span class="sc">-</span> sales_amount) <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">&quot;pass&quot;</span>, <span class="st">&#39;fail&#39;</span>), </span>
<span id="cb235-4"><a href="fpa.html#cb235-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">out_cost =</span> sales_unit_cost <span class="sc">*</span> sales_quantity, </span>
<span id="cb235-5"><a href="fpa.html#cb235-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">res_cost =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(out_cost <span class="sc">-</span> total_cost) <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">&quot;pass&quot;</span>, <span class="st">&#39;fail&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb235-6"><a href="fpa.html#cb235-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(res_sales <span class="sc">==</span> <span class="st">&quot;fail&quot;</span> <span class="sc">|</span> res_cost <span class="sc">==</span> <span class="st">&quot;fail&quot;</span>) </span>
<span id="cb235-7"><a href="fpa.html#cb235-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-8"><a href="fpa.html#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(v_amt, d_amt)</span></code></pre></div>
<pre><code>&gt; # A tibble: 0 x 27
&gt; # ... with 27 variables: sales_unit_price &lt;dbl&gt;, sales_quantity &lt;dbl&gt;,
&gt; #   sales_amount &lt;dbl&gt;, sales_unit_cost &lt;dbl&gt;, total_cost &lt;dbl&gt;,
&gt; #   return_quantity &lt;dbl&gt;, return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;,
&gt; #   discount_amount &lt;dbl&gt;, discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;,
&gt; #   start_date &lt;dttm&gt;, end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;,
&gt; #   store_name &lt;chr&gt;, status &lt;chr&gt;, employee_count &lt;dbl&gt;,
&gt; #   selling_area_size &lt;dbl&gt;, continent_name &lt;chr&gt;, ...</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="fpa.html#cb237-1" aria-hidden="true" tabindex="-1"></a>d_amt <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="fpa.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">diff_sales =</span> sales_unit_price <span class="sc">*</span> sales_quantity <span class="sc">-</span> sales_amount, </span>
<span id="cb237-3"><a href="fpa.html#cb237-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">diff_cost =</span> sales_unit_cost <span class="sc">*</span> sales_quantity <span class="sc">-</span> total_cost) <span class="sc">%&gt;%</span> </span>
<span id="cb237-4"><a href="fpa.html#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_total_sales =</span> <span class="fu">sum</span>(diff_sales), </span>
<span id="cb237-5"><a href="fpa.html#cb237-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">diff_total_cost =</span> <span class="fu">sum</span>(diff_cost))</span></code></pre></div>
<pre><code>&gt; # A tibble: 1 x 2
&gt;   diff_total_sales diff_total_cost
&gt;              &lt;dbl&gt;           &lt;dbl&gt;
&gt; 1         7130133.        6855349.</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="fpa.html#cb239-1" aria-hidden="true" tabindex="-1"></a>d_date <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb239-2"><a href="fpa.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> end_date <span class="sc">-</span> start_date) <span class="sc">%&gt;%</span> </span>
<span id="cb239-3"><a href="fpa.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(period <span class="sc">&gt;</span> <span class="dv">365</span>)</span>
<span id="cb239-4"><a href="fpa.html#cb239-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-5"><a href="fpa.html#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(v_date, d_date)</span></code></pre></div>
<pre><code>&gt; # A tibble: 0 x 27
&gt; # ... with 27 variables: sales_unit_price &lt;dbl&gt;, sales_quantity &lt;dbl&gt;,
&gt; #   sales_amount &lt;dbl&gt;, sales_unit_cost &lt;dbl&gt;, total_cost &lt;dbl&gt;,
&gt; #   return_quantity &lt;dbl&gt;, return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;,
&gt; #   discount_amount &lt;dbl&gt;, discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;,
&gt; #   start_date &lt;dttm&gt;, end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;,
&gt; #   store_name &lt;chr&gt;, status &lt;chr&gt;, employee_count &lt;dbl&gt;,
&gt; #   selling_area_size &lt;dbl&gt;, continent_name &lt;chr&gt;, ...</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="fpa.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(sales_df, status)</span></code></pre></div>
<pre><code>&gt; # A tibble: 2 x 2
&gt;   status      n
&gt; * &lt;chr&gt;   &lt;int&gt;
&gt; 1 Off      3090
&gt; 2 On     152642</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="fpa.html#cb243-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="fpa.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(status <span class="sc">==</span> <span class="st">&#39;Off&#39;</span> <span class="sc">&amp;</span> (employee_count <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> selling_area_size <span class="sc">&gt;</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>&gt; # A tibble: 3,090 x 27
&gt;    sales_unit_price sales_quantity sales_amount sales_unit_cost total_cost
&gt;               &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;
&gt;  1             15.0            180       2698.             7.64     1375. 
&gt;  2             25.0            360       8996.            12.7      4586. 
&gt;  3            120.               4        480.            61.2       245. 
&gt;  4            269                4       1076            137.        549. 
&gt;  5             76.0              4        304.            38.7       155. 
&gt;  6             16.9              4         67.6            8.62       34.5
&gt;  7             76.0              4        304.            38.7       155. 
&gt;  8             39.9              4        160.            20.3        81.4
&gt;  9            110.               4        440.            56.1       224. 
&gt; 10            270.               4       1080.           138.        550. 
&gt; # ... with 3,080 more rows, and 22 more variables: return_quantity &lt;dbl&gt;,
&gt; #   return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;, discount_amount &lt;dbl&gt;,
&gt; #   discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;, start_date &lt;dttm&gt;,
&gt; #   end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;, store_name &lt;chr&gt;,
&gt; #   status &lt;chr&gt;, employee_count &lt;dbl&gt;, selling_area_size &lt;dbl&gt;,
&gt; #   continent_name &lt;chr&gt;, region_country_name &lt;chr&gt;, product_name &lt;chr&gt;,
&gt; #   product_subcategory &lt;chr&gt;, product_category &lt;chr&gt;, manufacturer &lt;chr&gt;, ...</code></pre>
</div>
<div id="eda" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> EDA</h2>
<p>We will focus on columns of class name, product category, manufacturer, store type, and sales unit price. Columns of promotion name, start date, end date, status, channel name, brand name, and continent are left unused.</p>
<div id="categorical" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Categorical</h3>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="fpa.html#cb245-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb245-2"><a href="fpa.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.character)) <span class="sc">%&gt;%</span> </span>
<span id="cb245-3"><a href="fpa.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>()</span></code></pre></div>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="fpa.html#cb246-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/skim1.png&quot;</span>)</span></code></pre></div>
<p><img src="img/skim1.png" width="960" /></p>
<p>Quickly extract categorical variables with less than 10 unique values and then explore them.
1. 69% of sales is done via store across the world. 16% is done by online. Only US uses catalog. China, Germany, and US use online.
2. 50% of sales of expensive computers (50%) is from a supplier (Proseware, Inc.).</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="fpa.html#cb247-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="fpa.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.character) <span class="sc">%&gt;%</span></span>
<span id="cb247-3"><a href="fpa.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(colvar, value) <span class="sc">%&gt;%</span> </span>
<span id="cb247-4"><a href="fpa.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(colvar) <span class="sc">%&gt;%</span> </span>
<span id="cb247-5"><a href="fpa.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">uniq =</span> <span class="fu">n_distinct</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb247-6"><a href="fpa.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(uniq <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb247-7"><a href="fpa.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(colvar) <span class="sc">%&gt;%</span> </span>
<span id="cb247-8"><a href="fpa.html#cb247-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dput</span>()</span></code></pre></div>
<pre><code>&gt; c(&quot;brand_name&quot;, &quot;channel_name&quot;, &quot;class_name&quot;, &quot;continent_name&quot;, 
&gt; &quot;manufacturer&quot;, &quot;product_category&quot;, &quot;promotion_name&quot;, &quot;status&quot;, 
&gt; &quot;store_type&quot;)</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="fpa.html#cb249-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb249-2"><a href="fpa.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;brand_name&quot;</span>, <span class="st">&quot;channel_name&quot;</span>, <span class="st">&quot;class_name&quot;</span>, <span class="st">&quot;continent_name&quot;</span>, <span class="st">&quot;manufacturer&quot;</span>, </span>
<span id="cb249-3"><a href="fpa.html#cb249-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;product_category&quot;</span>, <span class="st">&quot;promotion_name&quot;</span>, <span class="st">&quot;status&quot;</span>, <span class="st">&quot;store_type&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-4"><a href="fpa.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(table)</span></code></pre></div>
<pre><code>&gt; $brand_name
&gt; 
&gt;             A. Datum      Adventure Works              Contoso 
&gt;                13979                11225                50214 
&gt;             Fabrikam              Litware    Northwind Traders 
&gt;                15958                 3521                 1905 
&gt;            Proseware     Southridge Video    The Phone Company 
&gt;                17719                16407                14352 
&gt; Wide World Importers 
&gt;                10452 
&gt; 
&gt; $channel_name
&gt; 
&gt;  Catalog   Online Reseller    Store 
&gt;     6277    24200    18035   107220 
&gt; 
&gt; $class_name
&gt; 
&gt;  Deluxe Economy Regular 
&gt;   18131   54040   83561 
&gt; 
&gt; $continent_name
&gt; 
&gt;          Asia        Europe North America 
&gt;         44831         39907         70994 
&gt; 
&gt; $manufacturer
&gt; 
&gt; A. Datum Corporation      Adventure Works         Contoso, Ltd 
&gt;                13979                11225                50214 
&gt;       Fabrikam, Inc.        Litware, Inc.    Northwind Traders 
&gt;                15958                 3521                 1905 
&gt;      Proseware, Inc.     Southridge Video    The Phone Company 
&gt;                17719                16407                14352 
&gt; Wide World Importers 
&gt;                10452 
&gt; 
&gt; $product_category
&gt; 
&gt;                         Audio        Cameras and camcorders 
&gt;                          7215                         36375 
&gt;                   Cell phones                     Computers 
&gt;                         26893                         56901 
&gt; Music, Movies and Audio Books                  TV and Video 
&gt;                          8385                         19963 
&gt; 
&gt; $promotion_name
&gt; 
&gt;                Asian Holiday Promotion                 Asian Spring Promotion 
&gt;                                   8757                                  10758 
&gt;                 Asian Summer Promotion      European Back-to-Scholl Promotion 
&gt;                                   4594                                   5983 
&gt;             European Holiday Promotion              European Spring Promotion 
&gt;                                  16699                                   6537 
&gt;                            No Discount North America Back-to-School Promotion 
&gt;                                  61480                                   8695 
&gt;        North America Holiday Promotion         North America Spring Promotion 
&gt;                                  15621                                  16608 
&gt; 
&gt; $status
&gt; 
&gt;    Off     On 
&gt;   3090 152642 
&gt; 
&gt; $store_type
&gt; 
&gt;  Catalog   Online Reseller    Store 
&gt;     6277    24200    18035   107220</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="fpa.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(sales_df<span class="sc">$</span>channel_name, sales_df<span class="sc">$</span>store_type))</span></code></pre></div>
<pre><code>&gt;           
&gt;               Catalog     Online   Reseller      Store
&gt;   Catalog  0.04030642 0.00000000 0.00000000 0.00000000
&gt;   Online   0.00000000 0.15539517 0.00000000 0.00000000
&gt;   Reseller 0.00000000 0.00000000 0.11580793 0.00000000
&gt;   Store    0.00000000 0.00000000 0.00000000 0.68849048</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="fpa.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">table</span>(sales_df<span class="sc">$</span>region_country_name, sales_df<span class="sc">$</span>store_type), <span class="at">FUN =</span> <span class="fu">list</span>(<span class="at">Total =</span> sum), <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>&gt;                  
&gt;                   Catalog Online Reseller  Store  Total
&gt;   Armenia               0      0        0    850    850
&gt;   Australia             0      0        0   2728   2728
&gt;   Bhutan                0      0        0    979    979
&gt;   Canada                0      0        0   2753   2753
&gt;   China                 0   9190     7311   4732  21233
&gt;   Denmark               0      0        0    541    541
&gt;   France                0      0     5097   3271   8368
&gt;   Germany               0   8508        0   5093  13601
&gt;   Greece                0      0        0    519    519
&gt;   India                 0      0        0   2674   2674
&gt;   Iran                  0      0        0   1705   1705
&gt;   Ireland               0      0        0    508    508
&gt;   Italy                 0      0        0   1925   1925
&gt;   Japan                 0      0        0   5569   5569
&gt;   Kyrgyzstan            0      0        0    900    900
&gt;   Malta                 0      0        0    514    514
&gt;   Pakistan              0      0        0   1345   1345
&gt;   Poland                0      0        0    579    579
&gt;   Portugal              0      0        0    496    496
&gt;   Romania               0      0        0    507    507
&gt;   Russia                0      0        0   2222   2222
&gt;   Singapore             0      0        0    930    930
&gt;   Slovenia              0      0        0    536    536
&gt;   South Korea           0      0        0   1220   1220
&gt;   Spain                 0      0        0    560    560
&gt;   Sweden                0      0        0    511    511
&gt;   Switzerland           0      0        0    530    530
&gt;   Syria                 0      0        0   1182   1182
&gt;   Taiwan                0      0        0    764    764
&gt;   Thailand              0      0        0   1089   1089
&gt;   the Netherlands       0      0        0    537    537
&gt;   Turkmenistan          0      0        0   1663   1663
&gt;   United Kingdom        0      0        0   7453   7453
&gt;   United States      6277   6502     5627  49835  68241
&gt;   Total              6277  24200    18035 107220 155732</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="fpa.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(<span class="fu">xtabs</span>(<span class="sc">~</span> product_category <span class="sc">+</span> class_name, <span class="at">data =</span> sales_df))</span></code></pre></div>
<pre><code>&gt;                               class_name Deluxe Economy Regular
&gt; product_category                                               
&gt; Audio                                       923    4393    1899
&gt; Cameras and camcorders                     4277   10561   21537
&gt; Cell phones                                4495    6011   16387
&gt; Computers                                  5164   24751   26986
&gt; Music, Movies and Audio Books              2769    1657    3959
&gt; TV and Video                                503    6667   12793</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="fpa.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(<span class="fu">table</span>(sales_df<span class="sc">$</span>manufacturer, sales_df<span class="sc">$</span>product_category, sales_df<span class="sc">$</span>class_name))</span></code></pre></div>
<pre><code>&gt;                                                     Deluxe Economy Regular
&gt;                                                                           
&gt; A. Datum Corporation Audio                               0       0       0
&gt;                      Cameras and camcorders           1697    2996    9286
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                           0       0       0
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0
&gt; Adventure Works      Audio                               0       0       0
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                         849    2571    4214
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                      221    1573    1797
&gt; Contoso, Ltd         Audio                             643    1609     759
&gt;                      Cameras and camcorders            824    4618    3222
&gt;                      Cell phones                      1550    4142    6849
&gt;                      Computers                         942    9445    6100
&gt;                      Music, Movies and Audio Books    1401     839    1967
&gt;                      TV and Video                        0     951    4353
&gt; Fabrikam, Inc.       Audio                               0       0       0
&gt;                      Cameras and camcorders           1756    2947    9029
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                           0     294    1932
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0
&gt; Litware, Inc.        Audio                               0       0       0
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                           0       0       0
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                       39    1142    2340
&gt; Northwind Traders    Audio                               0    1609     296
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                           0       0       0
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0
&gt; Proseware, Inc.      Audio                               0       0       0
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                        2534    4955   10230
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0
&gt; Southridge Video     Audio                               0       0       0
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                          64    4212     406
&gt;                      Music, Movies and Audio Books    1368     818    1992
&gt;                      TV and Video                      243    3001    4303
&gt; The Phone Company    Audio                               0       0       0
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                      2945    1869    9538
&gt;                      Computers                           0       0       0
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0
&gt; Wide World Importers Audio                             280    1175     844
&gt;                      Cameras and camcorders              0       0       0
&gt;                      Cell phones                         0       0       0
&gt;                      Computers                         775    3274    4104
&gt;                      Music, Movies and Audio Books       0       0       0
&gt;                      TV and Video                        0       0       0</code></pre>
<p>Plot categorical variables based on frequency count. Refer to <a href="https://ggplot2-book.org/">ggplot2: elegant graphics for data analysis</a> to learn how to plot.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="fpa.html#cb259-1" aria-hidden="true" tabindex="-1"></a>sales_df<span class="sc">%&gt;%</span> </span>
<span id="cb259-2"><a href="fpa.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> class_name, <span class="at">fill =</span> class_name)) <span class="sc">+</span></span>
<span id="cb259-3"><a href="fpa.html#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> .<span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb259-4"><a href="fpa.html#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..count..), <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb259-5"><a href="fpa.html#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb259-6"><a href="fpa.html#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="fpa.html#cb260-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_eda_p1.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_eda_p1.png" width="960" /></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="fpa.html#cb261-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="fpa.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(product_category, class_name, manufacturer, store_type) <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="fpa.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>n, </span>
<span id="cb261-4"><a href="fpa.html#cb261-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>,  </span>
<span id="cb261-5"><a href="fpa.html#cb261-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;val&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-6"><a href="fpa.html#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(val, n, var, sum)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-7"><a href="fpa.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, val)) <span class="sc">+</span></span>
<span id="cb261-8"><a href="fpa.html#cb261-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb261-9"><a href="fpa.html#cb261-9" aria-hidden="true" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb261-10"><a href="fpa.html#cb261-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var, <span class="at">scales =</span> <span class="st">&#39;free_y&#39;</span>) <span class="sc">+</span></span>
<span id="cb261-11"><a href="fpa.html#cb261-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="fpa.html#cb262-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_eda_p2.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_eda_p2.png" width="960" /></p>
<p>Reshape the data from a long format to a wide format. <code>filter</code> data based on the specified conditions and <code>count</code> a variable.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="fpa.html#cb263-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb263-2"><a href="fpa.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(class_name, product_category, manufacturer, store_type) <span class="sc">%&gt;%</span> </span>
<span id="cb263-3"><a href="fpa.html#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(store_type, n, <span class="at">fill =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>&gt; # A tibble: 57 x 7
&gt;    class_name product_category       manufacturer  Catalog Online Reseller Store
&gt;    &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
&gt;  1 Deluxe     Audio                  Contoso, Ltd       20     80       55   488
&gt;  2 Deluxe     Audio                  Wide World I~      12     46       50   172
&gt;  3 Deluxe     Cameras and camcorders A. Datum Cor~      66    230      173  1228
&gt;  4 Deluxe     Cameras and camcorders Contoso, Ltd       37    133      114   540
&gt;  5 Deluxe     Cameras and camcorders Fabrikam, In~      74    276      221  1185
&gt;  6 Deluxe     Cell phones            Contoso, Ltd       71    243      203  1033
&gt;  7 Deluxe     Cell phones            The Phone Co~     112    508      392  1933
&gt;  8 Deluxe     Computers              Adventure Wo~      38    124      103   584
&gt;  9 Deluxe     Computers              Contoso, Ltd       41    161      151   589
&gt; 10 Deluxe     Computers              Proseware, I~      92    370      282  1790
&gt; # ... with 47 more rows</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="fpa.html#cb265-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="fpa.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(region_country_name <span class="sc">==</span> <span class="st">&#39;United States&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb265-3"><a href="fpa.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(store_name)</span></code></pre></div>
<pre><code>&gt; # A tibble: 198 x 2
&gt;    store_name                      n
&gt;  * &lt;chr&gt;                       &lt;int&gt;
&gt;  1 Contoso Albany Store          280
&gt;  2 Contoso Alexandria Store      266
&gt;  3 Contoso Anchorage Store       244
&gt;  4 Contoso Annapolis Store       271
&gt;  5 Contoso Appleton Store        279
&gt;  6 Contoso Arlington Store       258
&gt;  7 Contoso Atlantic City Store   275
&gt;  8 Contoso Attleboro Store       243
&gt;  9 Contoso Aurora Store          282
&gt; 10 Contoso Austin Store          255
&gt; # ... with 188 more rows</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="fpa.html#cb267-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb267-2"><a href="fpa.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(store_name) <span class="sc">%&gt;%</span> </span>
<span id="cb267-3"><a href="fpa.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">8000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-4"><a href="fpa.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(store_name)</span></code></pre></div>
<pre><code>&gt; # A tibble: 2 x 2
&gt; # Groups:   store_name [2]
&gt;   store_name                      n
&gt;   &lt;chr&gt;                       &lt;int&gt;
&gt; 1 Contoso Asia Online Store    9190
&gt; 2 Contoso Europe Online Store  8508</code></pre>
</div>
<div id="numeric" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Numeric</h3>
<p>This section focus on sales_unit_price.
1. <code>sd</code> of return_quantity, discount_quantity, and discount_percent is small. Their fraud risk is low.
2. sales_unit_price is skewed. However, it shows a normal distribution at the level product category.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="fpa.html#cb269-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb269-2"><a href="fpa.html#cb269-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb269-3"><a href="fpa.html#cb269-3" aria-hidden="true" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb269-4"><a href="fpa.html#cb269-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(numeric.sd <span class="sc">&lt;</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="fpa.html#cb270-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(sales_df, sales_unit_price)   </span>
<span id="cb270-2"><a href="fpa.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="fpa.html#cb270-3" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb270-4"><a href="fpa.html#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb270-5"><a href="fpa.html#cb270-5" aria-hidden="true" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>(sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb270-6"><a href="fpa.html#cb270-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(numeric.sd <span class="sc">!=</span> <span class="dv">0</span>) </span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="fpa.html#cb271-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/skim2.png&quot;</span>)</span></code></pre></div>
<p><img src="img/skim2.png" width="960" /></p>
<p>Plot numeric variables.
1. There is a a linear relationship between sales unit price and sales unit cost.
2. Most of sales is below 100. Popular products have price below 500 and cost below 250.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="fpa.html#cb272-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb272-2"><a href="fpa.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sales_unit_price)) <span class="sc">+</span></span>
<span id="cb272-3"><a href="fpa.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">binwidth =</span> <span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb272-4"><a href="fpa.html#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb272-5"><a href="fpa.html#cb272-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>() </span></code></pre></div>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="fpa.html#cb273-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_eda_p3.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_eda_p3.png" width="960" /></p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="fpa.html#cb274-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb274-2"><a href="fpa.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sales_unit_price, sales_unit_cost, <span class="at">z =</span> sales_quantity)) <span class="sc">+</span></span>
<span id="cb274-3"><a href="fpa.html#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_hex</span>(<span class="at">bins =</span> <span class="dv">35</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb274-4"><a href="fpa.html#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() </span></code></pre></div>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="fpa.html#cb275-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_eda_p4.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_eda_p4.png" width="960" /></p>
<ol style="list-style-type: decimal">
<li>52% of revenue comes from regular class products (Computers, Cameras and camcorders, TV and Video) with price ranging from 100 to 1,000.</li>
<li><code>summarize</code> sales unit price of different manufacturer within a class name and product category.</li>
<li><code>summarize</code> sales unit price by product name when class name is Deluxe.</li>
</ol>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="fpa.html#cb276-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="fpa.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">cut =</span> <span class="fu">cut</span>(sales_unit_price, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>)), </span>
<span id="cb276-3"><a href="fpa.html#cb276-3" aria-hidden="true" tabindex="-1"></a>           class_name, product_category) <span class="sc">%&gt;%</span> </span>
<span id="cb276-4"><a href="fpa.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sales_quantity =</span> <span class="fu">sum</span>(sales_quantity), </span>
<span id="cb276-5"><a href="fpa.html#cb276-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_sales_amount =</span> <span class="fu">sum</span>(sales_amount), </span>
<span id="cb276-6"><a href="fpa.html#cb276-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">cut_pct_sales_amount =</span> <span class="fu">round</span>(total_sales_amount <span class="sc">/</span> <span class="fu">sum</span>(sales_df<span class="sc">$</span>sales_amount), <span class="dv">2</span>), </span>
<span id="cb276-7"><a href="fpa.html#cb276-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb276-8"><a href="fpa.html#cb276-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>cut_pct_sales_amount) </span></code></pre></div>
<pre><code>&gt; # A tibble: 41 x 6
&gt;    cut           class_name product_category  total_sales_quan~ total_sales_amo~
&gt;    &lt;fct&gt;         &lt;chr&gt;      &lt;chr&gt;                         &lt;dbl&gt;            &lt;dbl&gt;
&gt;  1 (100,1e+03]   Regular    Computers                    304943       125813827.
&gt;  2 (100,1e+03]   Regular    Cameras and camc~            249164       113427331.
&gt;  3 (100,1e+03]   Regular    TV and Video                 154768        67684579.
&gt;  4 (2e+03,3e+03] Deluxe     Computers                     16579        38894182.
&gt;  5 (100,1e+03]   Regular    Cell phones                  126686        34144060.
&gt;  6 (100,1e+03]   Economy    Computers                    118495        24821503.
&gt;  7 (1e+03,2e+03] Deluxe     Cameras and camc~             16204        24913696.
&gt;  8 (100,1e+03]   Deluxe     Cameras and camc~             33642        14400906.
&gt;  9 (100,1e+03]   Economy    Cameras and camc~             71316        15073062.
&gt; 10 (100,1e+03]   Deluxe     Cell phones                   40044        13470115.
&gt; # ... with 31 more rows, and 1 more variable: cut_pct_sales_amount &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="fpa.html#cb278-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb278-2"><a href="fpa.html#cb278-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">near</span>(sales_unit_price, <span class="fu">max</span>(sales_unit_price), <span class="at">tol =</span> <span class="fu">sd</span>(sales_unit_price)))</span></code></pre></div>
<pre><code>&gt; # A tibble: 66 x 27
&gt;    sales_unit_price sales_quantity sales_amount sales_unit_cost total_cost
&gt;               &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;
&gt;  1            2900.              9       24360.            961.      8647.
&gt;  2            2900.             10       29000.            961.      9608.
&gt;  3            2900.              6       17400.            961.      5765.
&gt;  4            2900.              6       17400.            961.      5765.
&gt;  5            2900.             20       58000.            961.     19216.
&gt;  6            2900.              6       16820.            961.      5765.
&gt;  7            2900.             10       29000.            961.      8647.
&gt;  8            2900.              6       17110.            961.      5765.
&gt;  9            2900.              6       16240.            961.      5765.
&gt; 10            2900.             30       87000.            961.     27864.
&gt; # ... with 56 more rows, and 22 more variables: return_quantity &lt;dbl&gt;,
&gt; #   return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;, discount_amount &lt;dbl&gt;,
&gt; #   discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;, start_date &lt;dttm&gt;,
&gt; #   end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;, store_name &lt;chr&gt;,
&gt; #   status &lt;chr&gt;, employee_count &lt;dbl&gt;, selling_area_size &lt;dbl&gt;,
&gt; #   continent_name &lt;chr&gt;, region_country_name &lt;chr&gt;, product_name &lt;chr&gt;,
&gt; #   product_subcategory &lt;chr&gt;, product_category &lt;chr&gt;, manufacturer &lt;chr&gt;, ...</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="fpa.html#cb280-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb280-2"><a href="fpa.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">between</span>(sales_unit_price, <span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>&gt; # A tibble: 318 x 27
&gt;    sales_unit_price sales_quantity sales_amount sales_unit_cost total_cost
&gt;               &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;
&gt;  1             0.95             26        24.7             0.48      12.5 
&gt;  2             0.95             13        12.4             0.48       6.24
&gt;  3             0.95             18        17.1             0.48       8.64
&gt;  4             0.95             18        17.1             0.48       8.64
&gt;  5             0.95             18        17.1             0.48       8.64
&gt;  6             0.95             24        21.1             0.48      11.5 
&gt;  7             0.95             36        33.8             0.48      17.3 
&gt;  8             0.95              9         8.55            0.48       3.84
&gt;  9             0.95             24        22.8             0.48      11.5 
&gt; 10             0.95             18        17.1             0.48       8.64
&gt; # ... with 308 more rows, and 22 more variables: return_quantity &lt;dbl&gt;,
&gt; #   return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;, discount_amount &lt;dbl&gt;,
&gt; #   discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;, start_date &lt;dttm&gt;,
&gt; #   end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;, store_name &lt;chr&gt;,
&gt; #   status &lt;chr&gt;, employee_count &lt;dbl&gt;, selling_area_size &lt;dbl&gt;,
&gt; #   continent_name &lt;chr&gt;, region_country_name &lt;chr&gt;, product_name &lt;chr&gt;,
&gt; #   product_subcategory &lt;chr&gt;, product_category &lt;chr&gt;, manufacturer &lt;chr&gt;, ...</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="fpa.html#cb282-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="fpa.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">new_number =</span> <span class="dv">1000</span> <span class="sc">*</span>(sales_unit_price <span class="sc">%/%</span> <span class="dv">1000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="fpa.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(new_number)</span></code></pre></div>
<pre><code>&gt; # A tibble: 3 x 2
&gt;   new_number      n
&gt; *      &lt;dbl&gt;  &lt;int&gt;
&gt; 1          0 150875
&gt; 2       1000   3349
&gt; 3       2000   1508</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="fpa.html#cb284-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb284-2"><a href="fpa.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class_name, product_category, manufacturer, store_type) <span class="sc">%&gt;%</span> </span>
<span id="cb284-3"><a href="fpa.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_unit_price), tibble<span class="sc">::</span><span class="fu">lst</span>(first, last, min, max, mean, median)))</span></code></pre></div>
<pre><code>&gt; # A tibble: 228 x 10
&gt; # Groups:   class_name, product_category, manufacturer [57]
&gt;    class_name product_category       manufacturer   store_type sales_unit_price~
&gt;    &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt;
&gt;  1 Deluxe     Audio                  Contoso, Ltd   Catalog                 299.
&gt;  2 Deluxe     Audio                  Contoso, Ltd   Online                  299.
&gt;  3 Deluxe     Audio                  Contoso, Ltd   Reseller                299.
&gt;  4 Deluxe     Audio                  Contoso, Ltd   Store                   299.
&gt;  5 Deluxe     Audio                  Wide World Im~ Catalog                 296 
&gt;  6 Deluxe     Audio                  Wide World Im~ Online                  296 
&gt;  7 Deluxe     Audio                  Wide World Im~ Reseller                296 
&gt;  8 Deluxe     Audio                  Wide World Im~ Store                   296 
&gt;  9 Deluxe     Cameras and camcorders A. Datum Corp~ Catalog                 290 
&gt; 10 Deluxe     Cameras and camcorders A. Datum Corp~ Online                  290 
&gt; # ... with 218 more rows, and 5 more variables: sales_unit_price_last &lt;dbl&gt;,
&gt; #   sales_unit_price_min &lt;dbl&gt;, sales_unit_price_max &lt;dbl&gt;,
&gt; #   sales_unit_price_mean &lt;dbl&gt;, sales_unit_price_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="fpa.html#cb286-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb286-2"><a href="fpa.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb286-3"><a href="fpa.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_unit_price), tibble<span class="sc">::</span><span class="fu">lst</span>(min, max, mean, median)), </span>
<span id="cb286-4"><a href="fpa.html#cb286-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_price_sales_amount =</span> <span class="fu">sum</span>(sales_amount[sales_unit_price <span class="sc">&gt;</span> <span class="fu">median</span>(sales_unit_price)]), </span>
<span id="cb286-5"><a href="fpa.html#cb286-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_class_sales_amount =</span> <span class="fu">sum</span>(sales_amount[class_name <span class="sc">==</span> <span class="st">&#39;Deluxe&#39;</span>])) </span></code></pre></div>
<pre><code>&gt; # A tibble: 1,689 x 7
&gt;    product_name            sales_unit_price~ sales_unit_price~ sales_unit_price~
&gt;  * &lt;chr&gt;                               &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
&gt;  1 A. Datum Advanced Digi~              188.              188.              188.
&gt;  2 A. Datum Advanced Digi~              188.              188.              188.
&gt;  3 A. Datum Advanced Digi~              188.              188.              188.
&gt;  4 A. Datum Advanced Digi~              188.              188.              188.
&gt;  5 A. Datum Advanced Digi~              188.              188.              188.
&gt;  6 A. Datum Advanced Digi~              188.              188.              188.
&gt;  7 A. Datum Advanced Digi~              188.              188.              188.
&gt;  8 A. Datum All in One Di~              188               188               188 
&gt;  9 A. Datum All in One Di~              188               188               188 
&gt; 10 A. Datum All in One Di~              188               188               188 
&gt; # ... with 1,679 more rows, and 3 more variables:
&gt; #   sales_unit_price_median &lt;dbl&gt;, total_price_sales_amount &lt;dbl&gt;,
&gt; #   total_class_sales_amount &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="fpa.html#cb288-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb288-2"><a href="fpa.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class_name <span class="sc">==</span> <span class="st">&quot;Deluxe&quot;</span>, </span>
<span id="cb288-3"><a href="fpa.html#cb288-3" aria-hidden="true" tabindex="-1"></a>                product_category <span class="sc">==</span> <span class="st">&quot;Cameras and camcorders&quot;</span>, </span>
<span id="cb288-4"><a href="fpa.html#cb288-4" aria-hidden="true" tabindex="-1"></a>                manufacturer <span class="sc">==</span> <span class="st">&quot;Fabrikam, Inc.&quot;</span>, </span>
<span id="cb288-5"><a href="fpa.html#cb288-5" aria-hidden="true" tabindex="-1"></a>                store_type <span class="sc">==</span> <span class="st">&#39;Store&#39;</span>) </span></code></pre></div>
<pre><code>&gt; # A tibble: 1,185 x 27
&gt;    sales_unit_price sales_quantity sales_amount sales_unit_cost total_cost
&gt;               &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;
&gt;  1              657             13         8541            218.      2830.
&gt;  2              645              8         5160            214.      1710.
&gt;  3              657              8         5256            218.      1741.
&gt;  4              657              8         5256            218.      1741.
&gt;  5              645              8         5160            214.      1710.
&gt;  6              657             13         8541            218.      2830.
&gt;  7             1560              8        12480            517.      4135.
&gt;  8             1560              8        12480            517.      4135.
&gt;  9              645              8         4773            214.      1710.
&gt; 10              645              8         4773            214.      1710.
&gt; # ... with 1,175 more rows, and 22 more variables: return_quantity &lt;dbl&gt;,
&gt; #   return_amount &lt;dbl&gt;, discount_quantity &lt;dbl&gt;, discount_amount &lt;dbl&gt;,
&gt; #   discount_percent &lt;dbl&gt;, promotion_name &lt;chr&gt;, start_date &lt;dttm&gt;,
&gt; #   end_date &lt;dttm&gt;, channel_name &lt;chr&gt;, store_type &lt;chr&gt;, store_name &lt;chr&gt;,
&gt; #   status &lt;chr&gt;, employee_count &lt;dbl&gt;, selling_area_size &lt;dbl&gt;,
&gt; #   continent_name &lt;chr&gt;, region_country_name &lt;chr&gt;, product_name &lt;chr&gt;,
&gt; #   product_subcategory &lt;chr&gt;, product_category &lt;chr&gt;, manufacturer &lt;chr&gt;, ...</code></pre>
</div>
</div>
<div id="business-ananlysis" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Business ananlysis</h2>
<div id="product-profit-margin" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Product profit margin</h3>
<ol style="list-style-type: decimal">
<li>There is no unusual profit margin for each product name in the cases of return or discount.</li>
<li>Profit margin percentage (average 50%) of each product name remains unchanged within each country.</li>
<li>Top 5 the most sold products only take 1% of revenue. There is no concentration risk.</li>
<li>Top 3 sales amount of product name from each product category.</li>
<li><code>summarize</code> the whole dataset based on class name, product category, manufacturer, store type.</li>
</ol>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="fpa.html#cb290-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb290-2"><a href="fpa.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(discount_quantity <span class="sc">&gt;</span> <span class="dv">0</span>, return_quantity <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb290-3"><a href="fpa.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_pct =</span> (sales_unit_price <span class="sc">-</span> sales_unit_cost) <span class="sc">/</span> sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb290-4"><a href="fpa.html#cb290-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb290-5"><a href="fpa.html#cb290-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(discount_quantity, discount_amount, return_quantity, return_amount, </span>
<span id="cb290-6"><a href="fpa.html#cb290-6" aria-hidden="true" tabindex="-1"></a>                     sales_quantity, sales_amount), sum), </span>
<span id="cb290-7"><a href="fpa.html#cb290-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">discount_amount_pct =</span> discount_amount <span class="sc">/</span> sales_amount, </span>
<span id="cb290-8"><a href="fpa.html#cb290-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">return_amount_pct =</span> return_amount <span class="sc">/</span> sales_amount, </span>
<span id="cb290-9"><a href="fpa.html#cb290-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_pm_pct =</span> <span class="fu">mean</span>(pm_pct)) </span></code></pre></div>
<pre><code>&gt; # A tibble: 1,680 x 10
&gt;    product_name   discount_quanti~ discount_amount return_quantity return_amount
&gt;  * &lt;chr&gt;                     &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;         &lt;dbl&gt;
&gt;  1 A. Datum Adva~               52           1480.              19         3582.
&gt;  2 A. Datum Adva~               72           1823.              26         4901 
&gt;  3 A. Datum Adva~               62           1638.              22         4147 
&gt;  4 A. Datum Adva~               72           1840.              25         4712.
&gt;  5 A. Datum Adva~               52           1529.              21         3958.
&gt;  6 A. Datum Adva~               87           2132.              27         5090.
&gt;  7 A. Datum Adva~               81           1942.              27         5090.
&gt;  8 A. Datum All ~               12            226.               4          752 
&gt;  9 A. Datum All ~               29            726.              16         3008 
&gt; 10 A. Datum All ~               39            996.              14         2632 
&gt; # ... with 1,670 more rows, and 5 more variables: sales_quantity &lt;dbl&gt;,
&gt; #   sales_amount &lt;dbl&gt;, discount_amount_pct &lt;dbl&gt;, return_amount_pct &lt;dbl&gt;,
&gt; #   avg_pm_pct &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="fpa.html#cb292-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb292-2"><a href="fpa.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_pct =</span> (sales_unit_price <span class="sc">-</span> sales_unit_cost) <span class="sc">/</span> sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb292-3"><a href="fpa.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_name, region_country_name) <span class="sc">%&gt;%</span> </span>
<span id="cb292-4"><a href="fpa.html#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(pm_pct), tibble<span class="sc">::</span><span class="fu">lst</span>(min, max, mean, median))) <span class="sc">%&gt;%</span></span>
<span id="cb292-5"><a href="fpa.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(pm_pct_min <span class="sc">!=</span> pm_pct_max, pm_pct_mean <span class="sc">!=</span> pm_pct_median) </span></code></pre></div>
<pre><code>&gt; # A tibble: 0 x 6
&gt; # Groups:   product_name [0]
&gt; # ... with 6 variables: product_name &lt;chr&gt;, region_country_name &lt;chr&gt;,
&gt; #   pm_pct_min &lt;dbl&gt;, pm_pct_max &lt;dbl&gt;, pm_pct_mean &lt;dbl&gt;, pm_pct_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="fpa.html#cb294-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb294-2"><a href="fpa.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_pct =</span> (sales_unit_price <span class="sc">-</span> sales_unit_cost) <span class="sc">/</span> sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb294-3"><a href="fpa.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> <span class="fu">fct_lump</span>(product_name, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb294-4"><a href="fpa.html#cb294-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product) <span class="sc">%&gt;%</span> </span>
<span id="cb294-5"><a href="fpa.html#cb294-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_quantity, sales_amount), sum), </span>
<span id="cb294-6"><a href="fpa.html#cb294-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_pm_pct =</span> <span class="fu">mean</span>(pm_pct), </span>
<span id="cb294-7"><a href="fpa.html#cb294-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_sales_pct =</span> sales_amount <span class="sc">/</span> <span class="fu">sum</span>(sales_df<span class="sc">$</span>sales_amount))</span></code></pre></div>
<pre><code>&gt; # A tibble: 8 x 5
&gt;   product                 sales_quantity sales_amount avg_pm_pct total_sales_pct
&gt; * &lt;fct&gt;                            &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
&gt; 1 Contoso Phone with 13-~           2229       37369.      0.540       0.0000656
&gt; 2 Fabrikam Trendsetter 1~           2195     2169738.      0.669       0.00381  
&gt; 3 Proseware All-In-One P~           2087      280983.      0.540       0.000493 
&gt; 4 Proseware LCD17W E202 ~           1861      236309.      0.490       0.000415 
&gt; 5 SV Car Video TFT7 M700~           2201      652008.      0.490       0.00114  
&gt; 6 The Phone Company PDA ~           2197      581941.      0.540       0.00102  
&gt; 7 The Phone Company Smar~           1684      215098.      0.490       0.000378 
&gt; 8 Other                          2272925   565308999.      0.545       0.993</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="fpa.html#cb296-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb296-2"><a href="fpa.html#cb296-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_pct =</span> (sales_unit_price <span class="sc">-</span> sales_unit_cost) <span class="sc">/</span> sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb296-3"><a href="fpa.html#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_category, product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb296-4"><a href="fpa.html#cb296-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_quantity, sales_amount), sum), </span>
<span id="cb296-5"><a href="fpa.html#cb296-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_pm_pct =</span> <span class="fu">mean</span>(pm_pct)) <span class="sc">%&gt;%</span> </span>
<span id="cb296-6"><a href="fpa.html#cb296-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> sales_amount, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>&gt; # A tibble: 18 x 5
&gt; # Groups:   product_category [6]
&gt;    product_category    product_name       sales_quantity sales_amount avg_pm_pct
&gt;    &lt;chr&gt;               &lt;chr&gt;                       &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
&gt;  1 Audio               &quot;Contoso 8GB Cloc~           2045      604561.      0.669
&gt;  2 Audio               &quot;Contoso 8GB Cloc~           1852      549003.      0.669
&gt;  3 Audio               &quot;Contoso 8GB Cloc~           1793      531711.      0.669
&gt;  4 Cameras and camcor~ &quot;Fabrikam Indepen~           1731     2771933.      0.669
&gt;  5 Cameras and camcor~ &quot;Fabrikam Indepen~           1525     2265750       0.669
&gt;  6 Cameras and camcor~ &quot;Fabrikam Trendse~           2195     2169738.      0.669
&gt;  7 Cell phones         &quot;Cigarette Lighte~          26400      659352.      0.490
&gt;  8 Cell phones         &quot;The Phone Compan~           2147      637178.      0.540
&gt;  9 Cell phones         &quot;The Phone Compan~           2098      621606       0.540
&gt; 10 Computers           &quot;Proseware Projec~           1924     4773190.      0.669
&gt; 11 Computers           &quot;Proseware Projec~           1736     4292782.      0.669
&gt; 12 Computers           &quot;Contoso Projecto~           1645     3712690.      0.669
&gt; 13 Music, Movies and ~ &quot;Contoso DVD 15-I~           1510      432433.      0.669
&gt; 14 Music, Movies and ~ &quot;SV DVD 15-Inch P~           1490      425995.      0.669
&gt; 15 Music, Movies and ~ &quot;SV DVD 15-Inch P~           1464      417681.      0.669
&gt; 16 TV and Video        &quot;Contoso Home The~           1653     1451764.      0.669
&gt; 17 TV and Video        &quot;Contoso Home The~           1578     1383240.      0.669
&gt; 18 TV and Video        &quot;Contoso Home The~           1494     1309052.      0.669</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="fpa.html#cb298-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb298-2"><a href="fpa.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_pct =</span> (sales_unit_price <span class="sc">-</span> sales_unit_cost) <span class="sc">/</span> sales_unit_price) <span class="sc">%&gt;%</span> </span>
<span id="cb298-3"><a href="fpa.html#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class_name, product_category, manufacturer, store_type) <span class="sc">%&gt;%</span> </span>
<span id="cb298-4"><a href="fpa.html#cb298-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_unit_price, pm_pct), tibble<span class="sc">::</span><span class="fu">lst</span>(min, max)), </span>
<span id="cb298-5"><a href="fpa.html#cb298-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">c</span>(sales_quantity, sales_amount), tibble<span class="sc">::</span><span class="fu">lst</span>(sum)), </span>
<span id="cb298-6"><a href="fpa.html#cb298-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">no_of_store =</span> <span class="fu">n_distinct</span>(store_name)) </span></code></pre></div>
<pre><code>&gt; # A tibble: 228 x 11
&gt; # Groups:   class_name, product_category, manufacturer [57]
&gt;    class_name product_category       manufacturer   store_type sales_unit_price~
&gt;    &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt;
&gt;  1 Deluxe     Audio                  Contoso, Ltd   Catalog                 299.
&gt;  2 Deluxe     Audio                  Contoso, Ltd   Online                  299.
&gt;  3 Deluxe     Audio                  Contoso, Ltd   Reseller                299.
&gt;  4 Deluxe     Audio                  Contoso, Ltd   Store                   299.
&gt;  5 Deluxe     Audio                  Wide World Im~ Catalog                 250.
&gt;  6 Deluxe     Audio                  Wide World Im~ Online                  250.
&gt;  7 Deluxe     Audio                  Wide World Im~ Reseller                250.
&gt;  8 Deluxe     Audio                  Wide World Im~ Store                   250.
&gt;  9 Deluxe     Cameras and camcorders A. Datum Corp~ Catalog                 281 
&gt; 10 Deluxe     Cameras and camcorders A. Datum Corp~ Online                  281 
&gt; # ... with 218 more rows, and 6 more variables: sales_unit_price_max &lt;dbl&gt;,
&gt; #   pm_pct_min &lt;dbl&gt;, pm_pct_max &lt;dbl&gt;, sales_quantity_sum &lt;dbl&gt;,
&gt; #   sales_amount_sum &lt;dbl&gt;, no_of_store &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="fpa.html#cb300-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="fpa.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span><span class="fu">c</span>(class_name, product_category, manufacturer, store_type)) <span class="sc">%&gt;%</span> </span>
<span id="cb300-3"><a href="fpa.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new =</span> <span class="fu">map</span>(data, <span class="sc">~</span>.x[[<span class="st">&#39;sales_unit_price&#39;</span>]][<span class="dv">20</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb300-4"><a href="fpa.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new)</span></code></pre></div>
<pre><code>&gt; # A tibble: 228 x 6
&gt;    store_type product_category       manufacturer         class_name data    new
&gt;    &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;                &lt;chr&gt;      &lt;lis&gt; &lt;dbl&gt;
&gt;  1 Store      Cell phones            The Phone Company    Regular    &lt;tbl~ 301  
&gt;  2 Store      Cell phones            Contoso, Ltd         Regular    &lt;tbl~  36.0
&gt;  3 Store      Computers              Proseware, Inc.      Regular    &lt;tbl~ 160  
&gt;  4 Store      TV and Video           Adventure Works      Regular    &lt;tbl~ 470. 
&gt;  5 Store      Computers              Contoso, Ltd         Regular    &lt;tbl~ 499  
&gt;  6 Store      Cameras and camcorders Contoso, Ltd         Economy    &lt;tbl~  40.0
&gt;  7 Store      Computers              Wide World Importers Economy    &lt;tbl~ 129  
&gt;  8 Store      Cameras and camcorders Fabrikam, Inc.       Regular    &lt;tbl~ 334  
&gt;  9 Store      Cameras and camcorders A. Datum Corporation Regular    &lt;tbl~ 338  
&gt; 10 Store      Cell phones            Contoso, Ltd         Economy    &lt;tbl~  15.0
&gt; # ... with 218 more rows</code></pre>
<p>Assume that product name containing “15-Inch” will be taxed at 17%. Calculate total tax amount on the specified product name. Some of product name is longer than 80 characters. Pull out to see them fully.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="fpa.html#cb302-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb302-2"><a href="fpa.html#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(product_name, <span class="st">&#39;15-Inch&#39;</span>), sales_unit_price <span class="sc">*</span> .<span class="dv">17</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb302-3"><a href="fpa.html#cb302-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_tax =</span> <span class="fu">sum</span>(tax))</span></code></pre></div>
<pre><code>&gt; # A tibble: 1 x 1
&gt;   total_tax
&gt;       &lt;dbl&gt;
&gt; 1    33917.</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="fpa.html#cb304-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="fpa.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&#39;15-Inch&#39;</span>, product_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-3"><a href="fpa.html#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_tax =</span> <span class="fu">sum</span>(sales_unit_price <span class="sc">*</span> .<span class="dv">17</span>))</span></code></pre></div>
<pre><code>&gt; # A tibble: 1 x 1
&gt;   total_tax
&gt;       &lt;dbl&gt;
&gt; 1    33917.</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="fpa.html#cb306-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="fpa.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">nchar</span>(product_name) <span class="sc">&gt;</span> <span class="dv">80</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb306-3"><a href="fpa.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb306-4"><a href="fpa.html#cb306-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span></code></pre></div>
<pre><code>&gt; [1] &quot;Proseware 23ppm Laser Printer with Wireless and Wired Network Interfaces M680 Grey&quot; 
&gt; [2] &quot;Proseware 23ppm Laser Printer with Wireless and Wired Network Interfaces M680 Black&quot;
&gt; [3] &quot;Proseware 23ppm Laser Printer with Wireless and Wired Network Interfaces M680 White&quot;</code></pre>
</div>
<div id="product-category" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Product category</h3>
<ol style="list-style-type: decimal">
<li><code>summarize</code> the average of discount amount and quantity by product category.</li>
<li><code>summarize</code> data based on product category, product subcategory, product name and <code>ggplot</code> sale amount and total cost.</li>
</ol>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="fpa.html#cb308-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb308-2"><a href="fpa.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(product_category, <span class="fu">contains</span>(<span class="st">&#39;discount&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb308-3"><a href="fpa.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_category) <span class="sc">%&gt;%</span> </span>
<span id="cb308-4"><a href="fpa.html#cb308-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">&#39;discount&#39;</span>)), mean))</span></code></pre></div>
<pre><code>&gt; # A tibble: 6 x 4
&gt;   product_category             discount_quanti~ discount_amount discount_percent
&gt; * &lt;chr&gt;                                   &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
&gt; 1 Audio                                   0.979            15.9           0.0806
&gt; 2 Cameras and camcorders                  1.14             66.6           0.0866
&gt; 3 Cell phones                             1.17             27.8           0.0868
&gt; 4 Computers                               1.04             44.5           0.0814
&gt; 5 Music, Movies and Audio Boo~            1.23             19.2           0.0939
&gt; 6 TV and Video                            1.07             59.7           0.0831</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="fpa.html#cb310-1" aria-hidden="true" tabindex="-1"></a>product_df <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb310-2"><a href="fpa.html#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_category, product_subcategory, product_name) <span class="sc">%&gt;%</span> </span>
<span id="cb310-3"><a href="fpa.html#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(sales_quantity, sales_amount, total_cost, return_amount, discount_amount), sum), </span>
<span id="cb310-4"><a href="fpa.html#cb310-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>) </span>
<span id="cb310-5"><a href="fpa.html#cb310-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-6"><a href="fpa.html#cb310-6" aria-hidden="true" tabindex="-1"></a>(p1 <span class="ot">&lt;-</span> product_df <span class="sc">%&gt;%</span> </span>
<span id="cb310-7"><a href="fpa.html#cb310-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sales_amount, total_cost, <span class="at">color =</span> product_subcategory, <span class="at">size =</span> sales_quantity)) <span class="sc">+</span></span>
<span id="cb310-8"><a href="fpa.html#cb310-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb310-9"><a href="fpa.html#cb310-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> product_category) <span class="sc">+</span></span>
<span id="cb310-10"><a href="fpa.html#cb310-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">accuracy =</span> <span class="cn">NULL</span>, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">+</span></span>
<span id="cb310-11"><a href="fpa.html#cb310-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">accuracy =</span> <span class="cn">NULL</span>, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">+</span></span>
<span id="cb310-12"><a href="fpa.html#cb310-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb310-13"><a href="fpa.html#cb310-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Total sales (&#39;000)&quot;</span>, </span>
<span id="cb310-14"><a href="fpa.html#cb310-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Total cost (&#39;000)&quot;</span>) <span class="sc">+</span></span>
<span id="cb310-15"><a href="fpa.html#cb310-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>())</span></code></pre></div>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="fpa.html#cb311-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_biz_p1.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_biz_p1.png" width="960" /></p>
</div>
<div id="manufactuer" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Manufactuer</h3>
<ol style="list-style-type: decimal">
<li>Identify the outlier of sales unit price based on manufacturer.</li>
<li><code>summarize</code> total sales amount and percentage of products purchased from manufacturers within each product category and <code>ggplot</code> barchart.</li>
</ol>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="fpa.html#cb312-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb312-2"><a href="fpa.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">manufacturer =</span> <span class="fu">fct_reorder</span>(manufacturer, sales_unit_price)) <span class="sc">%&gt;%</span> </span>
<span id="cb312-3"><a href="fpa.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sales_unit_price, manufacturer), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb312-4"><a href="fpa.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() </span></code></pre></div>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="fpa.html#cb313-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_biz_p2.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_biz_p2.png" width="960" /></p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="fpa.html#cb314-1" aria-hidden="true" tabindex="-1"></a>supplier_df <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb314-2"><a href="fpa.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(manufacturer, product_category) <span class="sc">%&gt;%</span> </span>
<span id="cb314-3"><a href="fpa.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_sales_amount =</span> <span class="fu">sum</span>(sales_amount), </span>
<span id="cb314-4"><a href="fpa.html#cb314-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct =</span> <span class="fu">round</span>(total_sales_amount <span class="sc">/</span> <span class="fu">sum</span>(sales_df<span class="sc">$</span>sales_amount), <span class="dv">2</span>), </span>
<span id="cb314-5"><a href="fpa.html#cb314-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-6"><a href="fpa.html#cb314-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>total_sales_amount)</span>
<span id="cb314-7"><a href="fpa.html#cb314-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-8"><a href="fpa.html#cb314-8" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">manufacturer =</span> <span class="fu">unique</span>(supplier_df<span class="sc">$</span>manufacturer), </span>
<span id="cb314-9"><a href="fpa.html#cb314-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">total_sales_amount =</span> <span class="dv">40000</span>) </span>
<span id="cb314-10"><a href="fpa.html#cb314-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-11"><a href="fpa.html#cb314-11" aria-hidden="true" tabindex="-1"></a>(p2 <span class="ot">&lt;-</span> supplier_df <span class="sc">%&gt;%</span> </span>
<span id="cb314-12"><a href="fpa.html#cb314-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">manufacturer =</span> <span class="fu">fct_reorder</span>(manufacturer, total_sales_amount, sum)) <span class="sc">%&gt;%</span> </span>
<span id="cb314-13"><a href="fpa.html#cb314-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_sales_amount, manufacturer)) <span class="sc">+</span></span>
<span id="cb314-14"><a href="fpa.html#cb314-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> product_category)) <span class="sc">+</span></span>
<span id="cb314-15"><a href="fpa.html#cb314-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text_df, <span class="fu">aes</span>(<span class="at">label =</span> manufacturer), <span class="at">hjust =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb314-16"><a href="fpa.html#cb314-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">accuracy =</span> <span class="cn">NULL</span>, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">+</span></span>
<span id="cb314-17"><a href="fpa.html#cb314-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb314-18"><a href="fpa.html#cb314-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Total sales (&#39;000)&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb314-19"><a href="fpa.html#cb314-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb314-20"><a href="fpa.html#cb314-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.86</span>, <span class="fl">0.18</span>), </span>
<span id="cb314-21"><a href="fpa.html#cb314-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&#39;transparent&#39;</span>, <span class="at">color =</span> <span class="cn">NA</span>), </span>
<span id="cb314-22"><a href="fpa.html#cb314-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb314-23"><a href="fpa.html#cb314-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="cn">NA</span>), </span>
<span id="cb314-24"><a href="fpa.html#cb314-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()))</span></code></pre></div>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="fpa.html#cb315-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_biz_p3.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_biz_p3.png" width="960" /></p>
</div>
<div id="store" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Store</h3>
<ol style="list-style-type: decimal">
<li>Calculate total sales amount for each store name. <code>ggplot</code> employee count and selling area size to identify outlier. For instance, one small store has more than 300 staffs.</li>
<li>Map store location across the world.</li>
</ol>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="fpa.html#cb316-1" aria-hidden="true" tabindex="-1"></a>staff_df <span class="ot">&lt;-</span> sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb316-2"><a href="fpa.html#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(store_name) <span class="sc">%&gt;%</span> </span>
<span id="cb316-3"><a href="fpa.html#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_sales_amount =</span> <span class="fu">sum</span>(sales_amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb316-4"><a href="fpa.html#cb316-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(store_name, employee_count, selling_area_size, total_sales_amount) <span class="sc">%&gt;%</span> </span>
<span id="cb316-5"><a href="fpa.html#cb316-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(store_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb316-6"><a href="fpa.html#cb316-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(employee_count))</span>
<span id="cb316-7"><a href="fpa.html#cb316-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-8"><a href="fpa.html#cb316-8" aria-hidden="true" tabindex="-1"></a>staff_df <span class="sc">%&gt;%</span> </span>
<span id="cb316-9"><a href="fpa.html#cb316-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(employee_count, selling_area_size)) <span class="sc">+</span></span>
<span id="cb316-10"><a href="fpa.html#cb316-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> total_sales_amount), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb316-11"><a href="fpa.html#cb316-11" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="fu">aes</span>(<span class="at">filter =</span> selling_area_size <span class="sc">&gt;</span> <span class="dv">80000</span>, </span>
<span id="cb316-12"><a href="fpa.html#cb316-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">description =</span> <span class="st">&quot;Typo error?&quot;</span>)) <span class="sc">+</span></span>
<span id="cb316-13"><a href="fpa.html#cb316-13" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="fu">aes</span>(<span class="at">filter =</span> employee_count <span class="sc">&gt;</span> <span class="dv">300</span>,</span>
<span id="cb316-14"><a href="fpa.html#cb316-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">description =</span> <span class="st">&quot;Enquery?&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="fpa.html#cb317-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_biz_p4.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_biz_p4.png" width="960" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="fpa.html#cb318-1" aria-hidden="true" tabindex="-1"></a>store_map <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="fpa.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(region <span class="sc">==</span> <span class="st">&#39;USA&#39;</span> <span class="sc">~</span> <span class="st">&quot;United States&quot;</span>, </span>
<span id="cb318-3"><a href="fpa.html#cb318-3" aria-hidden="true" tabindex="-1"></a>                            region <span class="sc">==</span> <span class="st">&#39;UK&#39;</span> <span class="sc">~</span> <span class="st">&quot;United Kingdom&quot;</span>, </span>
<span id="cb318-4"><a href="fpa.html#cb318-4" aria-hidden="true" tabindex="-1"></a>                            region <span class="sc">==</span> <span class="st">&#39;Netherlands&#39;</span> <span class="sc">~</span> <span class="st">&quot;the Netherlands&quot;</span>, </span>
<span id="cb318-5"><a href="fpa.html#cb318-5" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> region)) <span class="sc">%&gt;%</span> </span>
<span id="cb318-6"><a href="fpa.html#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb318-7"><a href="fpa.html#cb318-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(store_name, store_type, region_country_name) <span class="sc">%&gt;%</span> </span>
<span id="cb318-8"><a href="fpa.html#cb318-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(<span class="at">total_sales_amount =</span> <span class="fu">sum</span>(sales_amount), </span>
<span id="cb318-9"><a href="fpa.html#cb318-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>), </span>
<span id="cb318-10"><a href="fpa.html#cb318-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;region_country_name&quot;</span>)) </span>
<span id="cb318-11"><a href="fpa.html#cb318-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-12"><a href="fpa.html#cb318-12" aria-hidden="true" tabindex="-1"></a>(p3 <span class="ot">&lt;-</span> store_map <span class="sc">%&gt;%</span></span>
<span id="cb318-13"><a href="fpa.html#cb318-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(long, lat, <span class="at">group =</span> group, <span class="at">fill =</span> total_sales_amount)) <span class="sc">+</span></span>
<span id="cb318-14"><a href="fpa.html#cb318-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">borders</span>(<span class="st">&quot;world&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;gray85&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;gray80&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-15"><a href="fpa.html#cb318-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>() <span class="sc">+</span></span>
<span id="cb318-16"><a href="fpa.html#cb318-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb318-17"><a href="fpa.html#cb318-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">high =</span> <span class="st">&quot;green&quot;</span>, <span class="at">low =</span> <span class="st">&quot;red&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">midpoint =</span>  <span class="dv">18627586</span>) <span class="sc">+</span></span>
<span id="cb318-18"><a href="fpa.html#cb318-18" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb318-19"><a href="fpa.html#cb318-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb318-20"><a href="fpa.html#cb318-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">direction =</span> <span class="st">&#39;horizontal&#39;</span>, </span>
<span id="cb318-21"><a href="fpa.html#cb318-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb318-22"><a href="fpa.html#cb318-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), </span>
<span id="cb318-23"><a href="fpa.html#cb318-23" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb318-24"><a href="fpa.html#cb318-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Total sales&quot;</span>)) </span></code></pre></div>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="fpa.html#cb319-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/fpa_biz_p5.png&quot;</span>)</span></code></pre></div>
<p><img src="img/fpa_biz_p5.png" width="960" /></p>
</div>
</div>
<div id="info-graphic" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Info graphic</h2>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="fpa.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb320-2"><a href="fpa.html#cb320-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-3"><a href="fpa.html#cb320-3" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb320-4"><a href="fpa.html#cb320-4" aria-hidden="true" tabindex="-1"></a><span class="st">AACCCC</span></span>
<span id="cb320-5"><a href="fpa.html#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="st">AACCCC</span></span>
<span id="cb320-6"><a href="fpa.html#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="st">BBCCCC</span></span>
<span id="cb320-7"><a href="fpa.html#cb320-7" aria-hidden="true" tabindex="-1"></a><span class="st">BBCCCC</span></span>
<span id="cb320-8"><a href="fpa.html#cb320-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb320-9"><a href="fpa.html#cb320-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-10"><a href="fpa.html#cb320-10" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> p3 <span class="sc">+</span> p2 <span class="sc">+</span> p1 <span class="sc">+</span> </span>
<span id="cb320-11"><a href="fpa.html#cb320-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout) <span class="sc">+</span></span>
<span id="cb320-12"><a href="fpa.html#cb320-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Overview of business operations&quot;</span>, </span>
<span id="cb320-13"><a href="fpa.html#cb320-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&#39;Suppliers | Products | Stores&#39;</span>, </span>
<span id="cb320-14"><a href="fpa.html#cb320-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">caption =</span> <span class="st">&#39;RAudit Solution LLP</span><span class="sc">\n</span><span class="st">https://stewartli.github.io/tailwindcss/&#39;</span>) <span class="sc">&amp;</span></span>
<span id="cb320-15"><a href="fpa.html#cb320-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb320-16"><a href="fpa.html#cb320-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="fpa.html#cb321-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/info_graphics.png&quot;</span>)</span></code></pre></div>
<p><img src="img/info_graphics.png" width="960" /></p>
</div>
<div id="report" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Report</h2>
<p>A nice summary table and plot can be easily included in a <code>Rmarkdown</code> document. A final report is produced in the form of HTML, PDF, and Words.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="fpa.html#cb322-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/biz-report.png&quot;</span>)</span></code></pre></div>
<p><img src="img/biz-report.png" width="960" /></p>
</div>
<div id="dashboard" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Dashboard</h2>
<p>You might be asked to make a BI dashboard which allows your users to explore data interactively. To learn more, refer to <a href="https://mastering-shiny.org/">Mastering Shiny</a></p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="fpa.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb323-2"><a href="fpa.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb323-3"><a href="fpa.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb323-4"><a href="fpa.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb323-5"><a href="fpa.html#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(thematic)</span>
<span id="cb323-6"><a href="fpa.html#cb323-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-7"><a href="fpa.html#cb323-7" aria-hidden="true" tabindex="-1"></a>theme_toggle <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb323-8"><a href="fpa.html#cb323-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">div</span>(<span class="at">class =</span> <span class="st">&quot;custom-control custom-switch&quot;</span>,</span>
<span id="cb323-9"><a href="fpa.html#cb323-9" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">input</span>(</span>
<span id="cb323-10"><a href="fpa.html#cb323-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="st">&quot;custom_mode&quot;</span>,</span>
<span id="cb323-11"><a href="fpa.html#cb323-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;checkbox&quot;</span>,</span>
<span id="cb323-12"><a href="fpa.html#cb323-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">&quot;custom-control-input&quot;</span>,</span>
<span id="cb323-13"><a href="fpa.html#cb323-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">onclick =</span> <span class="fu">HTML</span>(<span class="st">&quot;Shiny.setInputValue(&#39;dark_mode&#39;, document.getElementById(&#39;custom_mode&#39;).value);&quot;</span>)</span>
<span id="cb323-14"><a href="fpa.html#cb323-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb323-15"><a href="fpa.html#cb323-15" aria-hidden="true" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">label</span>(</span>
<span id="cb323-16"><a href="fpa.html#cb323-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Mode&quot;</span>,</span>
<span id="cb323-17"><a href="fpa.html#cb323-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;custom_mode&quot;</span>,                                   </span>
<span id="cb323-18"><a href="fpa.html#cb323-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">&quot;custom-control-label&quot;</span>)</span>
<span id="cb323-19"><a href="fpa.html#cb323-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb323-20"><a href="fpa.html#cb323-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="fpa.html#cb324-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb324-2"><a href="fpa.html#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_toggle</span>(), </span>
<span id="cb324-3"><a href="fpa.html#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> bslib<span class="sc">::</span><span class="fu">bs_theme</span>(<span class="at">bootswatch =</span> <span class="st">&#39;minty&#39;</span>),   </span>
<span id="cb324-4"><a href="fpa.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb324-5"><a href="fpa.html#cb324-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb324-6"><a href="fpa.html#cb324-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>, </span>
<span id="cb324-7"><a href="fpa.html#cb324-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fluidRow</span>(</span>
<span id="cb324-8"><a href="fpa.html#cb324-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>, <span class="fu">selectInput</span>(<span class="st">&quot;productcat&quot;</span>, <span class="st">&quot;Product category&quot;</span>, <span class="fu">unique</span>(sales_df<span class="sc">$</span>product_category))), </span>
<span id="cb324-9"><a href="fpa.html#cb324-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">column</span>(<span class="dv">6</span>, <span class="fu">selectizeInput</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;Region&quot;</span>, <span class="fu">unique</span>(sales_df<span class="sc">$</span>region_country_name))) </span>
<span id="cb324-10"><a href="fpa.html#cb324-10" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb324-11"><a href="fpa.html#cb324-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;topsupplier&quot;</span>), </span>
<span id="cb324-12"><a href="fpa.html#cb324-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;storetype&quot;</span>)</span>
<span id="cb324-13"><a href="fpa.html#cb324-13" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb324-14"><a href="fpa.html#cb324-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb324-15"><a href="fpa.html#cb324-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">8</span>, </span>
<span id="cb324-16"><a href="fpa.html#cb324-16" aria-hidden="true" tabindex="-1"></a>      DT<span class="sc">::</span><span class="fu">DTOutput</span>(<span class="st">&quot;tbl&quot;</span>)</span>
<span id="cb324-17"><a href="fpa.html#cb324-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb324-18"><a href="fpa.html#cb324-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb324-19"><a href="fpa.html#cb324-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="fpa.html#cb325-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb325-2"><a href="fpa.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb325-3"><a href="fpa.html#cb325-3" aria-hidden="true" tabindex="-1"></a>    sales_df <span class="sc">%&gt;%</span> </span>
<span id="cb325-4"><a href="fpa.html#cb325-4" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(product_category <span class="sc">%in%</span> input<span class="sc">$</span>productcat, region_country_name <span class="sc">%in%</span> input<span class="sc">$</span>region)</span>
<span id="cb325-5"><a href="fpa.html#cb325-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-6"><a href="fpa.html#cb325-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>custom_mode, {</span>
<span id="cb325-7"><a href="fpa.html#cb325-7" aria-hidden="true" tabindex="-1"></a>    session<span class="sc">$</span><span class="fu">setCurrentTheme</span>(</span>
<span id="cb325-8"><a href="fpa.html#cb325-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (input<span class="sc">$</span>custom_mode) bslib<span class="sc">::</span><span class="fu">bs_theme</span>(<span class="at">bootswatch =</span> <span class="st">&#39;journal&#39;</span>) <span class="cf">else</span> bslib<span class="sc">::</span><span class="fu">bs_theme</span>(<span class="at">bootswatch =</span> <span class="st">&#39;minty&#39;</span>)</span>
<span id="cb325-9"><a href="fpa.html#cb325-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb325-10"><a href="fpa.html#cb325-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-11"><a href="fpa.html#cb325-11" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>topsupplier <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb325-12"><a href="fpa.html#cb325-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">df</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-13"><a href="fpa.html#cb325-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(manufacturer) <span class="sc">%&gt;%</span> </span>
<span id="cb325-14"><a href="fpa.html#cb325-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb325-15"><a href="fpa.html#cb325-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">amt =</span> <span class="fu">sum</span>(sales_amount)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-16"><a href="fpa.html#cb325-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_max</span>(<span class="at">order_by =</span> amt, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-17"><a href="fpa.html#cb325-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, amt)) <span class="sc">+</span></span>
<span id="cb325-18"><a href="fpa.html#cb325-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb325-19"><a href="fpa.html#cb325-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">unit =</span> <span class="st">&quot;K&quot;</span>)) <span class="sc">+</span></span>
<span id="cb325-20"><a href="fpa.html#cb325-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">scale =</span> <span class="fl">1e-6</span>, <span class="at">unit =</span> <span class="st">&quot;M&quot;</span>)) <span class="sc">+</span></span>
<span id="cb325-21"><a href="fpa.html#cb325-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Top 10 supplier (Frequency vs Amount)&quot;</span>, </span>
<span id="cb325-22"><a href="fpa.html#cb325-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb325-23"><a href="fpa.html#cb325-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>)</span>
<span id="cb325-24"><a href="fpa.html#cb325-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-25"><a href="fpa.html#cb325-25" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>storetype <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb325-26"><a href="fpa.html#cb325-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">df</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-27"><a href="fpa.html#cb325-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(store_type, class_name) <span class="sc">%&gt;%</span> </span>
<span id="cb325-28"><a href="fpa.html#cb325-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">amt =</span> <span class="fu">sum</span>(sales_amount), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-29"><a href="fpa.html#cb325-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">store_type =</span> <span class="fu">fct_reorder</span>(store_type, amt)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-30"><a href="fpa.html#cb325-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(store_type, amt, <span class="at">fill =</span> class_name)) <span class="sc">+</span></span>
<span id="cb325-31"><a href="fpa.html#cb325-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb325-32"><a href="fpa.html#cb325-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">scale =</span> <span class="fl">1e-6</span>, <span class="at">unit =</span> <span class="st">&quot;M&quot;</span>)) <span class="sc">+</span></span>
<span id="cb325-33"><a href="fpa.html#cb325-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-34"><a href="fpa.html#cb325-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sales amount break down (Store type vs Class name)&quot;</span>, </span>
<span id="cb325-35"><a href="fpa.html#cb325-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb325-36"><a href="fpa.html#cb325-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>, </span>
<span id="cb325-37"><a href="fpa.html#cb325-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, </span>
<span id="cb325-38"><a href="fpa.html#cb325-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>, </span>
<span id="cb325-39"><a href="fpa.html#cb325-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb325-40"><a href="fpa.html#cb325-40" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-41"><a href="fpa.html#cb325-41" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>tbl <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDT</span>(<span class="at">server =</span> <span class="cn">FALSE</span>, {</span>
<span id="cb325-42"><a href="fpa.html#cb325-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">df</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-43"><a href="fpa.html#cb325-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(product_subcategory, product_name, store_name, employee_count, selling_area_size) <span class="sc">%&gt;%</span> </span>
<span id="cb325-44"><a href="fpa.html#cb325-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">product_name =</span> <span class="fu">str_trunc</span>(product_name, <span class="at">width =</span> <span class="dv">40</span>, <span class="at">ellipsis =</span> <span class="st">&quot;...&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-45"><a href="fpa.html#cb325-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="cf">function</span>(x) <span class="fu">str_to_title</span>(<span class="fu">str_replace_all</span>(x, <span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)), <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb325-46"><a href="fpa.html#cb325-46" aria-hidden="true" tabindex="-1"></a>      DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb325-47"><a href="fpa.html#cb325-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(<span class="at">style =</span> <span class="st">&#39;caption-side: top; text-align: center;&#39;</span>,</span>
<span id="cb325-48"><a href="fpa.html#cb325-48" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">paste0</span>(<span class="st">&quot;Table: &quot;</span>, input<span class="sc">$</span>productcat, <span class="st">&quot; in &quot;</span>, input<span class="sc">$</span>region)), </span>
<span id="cb325-49"><a href="fpa.html#cb325-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">&quot;Scroller&quot;</span>, <span class="st">&quot;FixedColumns&quot;</span>, <span class="st">&quot;Buttons&quot;</span>), </span>
<span id="cb325-50"><a href="fpa.html#cb325-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb325-51"><a href="fpa.html#cb325-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">dom =</span> <span class="st">&quot;Bfrtip&quot;</span>,</span>
<span id="cb325-52"><a href="fpa.html#cb325-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">pageLength =</span> <span class="dv">15</span>, </span>
<span id="cb325-53"><a href="fpa.html#cb325-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">buttons =</span> <span class="fu">c</span>(<span class="st">&quot;copy&quot;</span>, <span class="st">&quot;print&quot;</span>, <span class="st">&quot;csv&quot;</span>, <span class="st">&quot;excel&quot;</span>, <span class="st">&quot;pdf&quot;</span>)</span>
<span id="cb325-54"><a href="fpa.html#cb325-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb325-55"><a href="fpa.html#cb325-55" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb325-56"><a href="fpa.html#cb325-56" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-57"><a href="fpa.html#cb325-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb325-58"><a href="fpa.html#cb325-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-59"><a href="fpa.html#cb325-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-60"><a href="fpa.html#cb325-60" aria-hidden="true" tabindex="-1"></a>thematic<span class="sc">::</span><span class="fu">thematic_shiny</span>()</span>
<span id="cb325-61"><a href="fpa.html#cb325-61" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="fpa.html#cb326-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/dashboard1.png&quot;</span>)</span></code></pre></div>
<p><img src="img/dashboard1.png" width="960" /></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="fpa.html#cb327-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;img/dashboard2.png&quot;</span>)</span></code></pre></div>
<p><img src="img/dashboard2.png" width="960" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="external-auditors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-fpa.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
